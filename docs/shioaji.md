# Shioaji SDK 規格參考

本文件說明永豐金證券 Shioaji Python API 的功能規格，這是台灣股票、期貨和選擇權自動化交易的核心工具。

---

## 功能範疇總覽

Shioaji SDK 提供七個主要的功能領域，涵蓋從登入認證到交易執行的完整流程。

**認證管理**負責處理 API 登入、憑證啟用和帳號管理。所有交易操作都需要先完成認證流程，其中下單交易還需要額外啟用數位憑證。

**商品檔查詢**用於取得股票、期貨、選擇權和指數的合約資訊。透過這個功能可以查詢商品代碼、漲跌停價格、參考價和當沖限制等資訊。

**即時行情**支援訂閱和退訂逐筆成交和五檔報價。這是實作即時警報系統的基礎，可用於監控關鍵樞紐股的價格變動。

**歷史資料**提供歷史 K 線和 Tick 資料的查詢功能，用於計算技術指標和績效分析。

**下單交易**涵蓋現貨和期貨的下單、改單和刪單操作。支援多種訂單類型，包括限價單、市價單和範圍市價單。

**帳務查詢**用於查詢庫存、損益和銀行餘額，是評估持倉健康度的資料來源。

**市場資訊**提供市場快照、排行榜和資券餘額等輔助資訊。

---

## 本專案使用場景

在實際應用中，本專案主要使用 Shioaji 的四個功能領域。

商品檔查詢用於取得台股合約資訊，例如 0050 ETF 或台積電 2330 的相關參數。

即時行情功能支援即時警報系統，用於監控 S&P 500 成分股或台股權值股的價格異動。

歷史資料功能是每日簡報的資料來源，用於計算績效表現和技術指標。

帳務查詢功能同樣服務於每日簡報，提供持倉健康度評估所需的庫存和損益資訊。

至於下單交易功能，目前尚未啟用，規劃在未來實作自動化交易執行時使用。

---

## 認證流程說明

使用 Shioaji 的第一步是透過 API Key 和 Secret Key 進行登入。登入成功後會返回所有可用的證券帳號列表，需要選擇一個作為預設帳號。

如果需要進行下單交易，還必須額外啟用數位憑證。憑證啟用需要提供憑證檔案路徑、憑證密碼和身分證字號。憑證有有效期限，可以透過 API 查詢到期時間。

在模擬模式下（simulation=True），憑證啟用是可選的，這方便了策略開發和測試階段的工作。

---

## 商品檔結構

Shioaji 的商品檔分為三種類型。

**股票合約**包含交易所代碼（TSE 上市、OTC 上櫃、OES 興櫃）、商品代碼、符號、名稱、漲停價、跌停價、參考價和當沖限制。存取方式是透過 Contracts.Stocks["代碼"]。

**期貨合約**包含商品代碼、類別、交割月份和結算日。例如 TXFA3 代表三月份的台指期，其中 TXF 是類別代碼，A3 是月份代碼。存取方式是 Contracts.Futures["代碼"]。

**選擇權合約**包含商品代碼、類別、履約價和選擇權類型（買權或賣權）。例如 TXO18000R3 代表履約價 18000 點的三月台指選擇權。存取方式是 Contracts.Options["代碼"]。

---

## 即時行情資料

即時行情提供兩種資料類型。

**逐筆成交**（Tick）包含商品代碼、時間戳記、開高低收價格、內外盤標記、成交量和累計成交量。其中 tick_type 為 1 代表外盤成交（買方主動），為 2 代表內盤成交（賣方主動）。

**五檔報價**（BidAsk）包含商品代碼、時間戳記、五檔買價買量和五檔賣價賣量。索引 0 代表最佳買賣價，索引 4 代表第五檔。

訂閱即時行情時，需要先取得商品合約物件，然後指定要訂閱的報價類型（Tick 或 BidAsk），資料會透過預設的回呼函數即時推送。

---

## 下單交易說明

下單時需要指定五個關鍵參數。

**委託價格**決定掛單的價位，使用限價單時必須指定。

**委託數量**決定買賣的股數或口數。

**買賣方向**分為買進（Buy）和賣出（Sell）。

**價格類型**分為限價單（LMT）、市價單（MKT）和範圍市價單（MKP）。

**訂單有效期**分為當日有效（ROD）、立即成交否則取消（IOC）和全部成交否則取消（FOK）。

對於股票交易，還需要指定交易單位。整股交易使用 Common，盤後零股使用 Odd，盤中零股則使用 IntradayOdd。

---

## 帳務資料結構

**庫存資訊**包含商品代碼、持有方向（多方或空方）、持有數量、成本價、最新價和損益金額。

**保證金資訊**（適用於期貨和選擇權）包含權益數、超額保證金、追繳金額和維持保證金。這些資訊對於期貨帳戶的風險控管至關重要。

---

## 模擬與正式環境差異

Shioaji 提供模擬環境供開發測試使用。模擬環境與正式環境的主要差異在於：憑證啟用在模擬環境是可選的；下單成交是模擬的，不會產生真實交易；行情數據是即時的，與正式環境相同；帳務數據則是模擬的。

建立模擬環境的方式是在初始化時指定 simulation=True 參數。
