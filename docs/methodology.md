# 投資決策系統方法論 — 完整自然語言描述

## 背景與核心定位

這份文件是整個投資決策系統的「唯一真實論述」（Single Source of Truth），當任何其他文件與本文件產生衝突時，一律以本文件的論述為準。本方法論採用 Rasmussen 的 SRK 認知工程模型來組織內容，分為三個層級：Skill 層（肌肉記憶，自動化執行）、Rule 層（If-Then 規則，條件式判斷）、以及 Knowledge 層（底層原理，深度理解）。

本系統的核心信念是：金融市場是一個複雜適應系統（Complex Adaptive System, CAS），而非簡單的統計隨機漫步。基於這個認識，系統採用雙環學習機制來持續反思與改進策略假設，並採用反脆弱設計來構建能從極端波動中獲益的結構。在選股策略上，系統以殘差動能（Residual Momentum）作為核心 Alpha 來源，並搭配統計嚴謹的驗證流程來確保策略有效性。

---

## 認知工程設計原則

本系統不是「交易機器人」，而是**認知義肢 (Cognitive Prosthesis)**——將人類有限的工作記憶、易受偏誤影響的判斷過程，外化為可靠的工具系統。

### 設計原則

| 原則             | 認知科學根據                  | 系統實踐                                      |
| :--------------- | :---------------------------- | :-------------------------------------------- |
| **SRK 對齊**     | Rasmussen 技能-規則-知識模型  | CLI 指令對應技能層次 (常用) 到知識層次 (除錯) |
| **認知卸載**     | 工作記憶容量有限 (Miller 7±2) | VIX 判斷、體制識別交給系統自動計算            |
| **雙重監控**     | Zimmerman + Pintrich          | 客觀數據 (行為記錄) + 主觀判斷 (信心校準)     |
| **執行鴻溝橋接** | Norman 互動模型               | 清晰指意、錯誤訊息建議修復                    |
| **漸進式揭露**   | 認知負荷理論                  | 先 DEFCON 燈號 → 再體制數字 → 最後細節        |

### 三層決策優先級 (否決權層級)

| 層級       | 類型   | 訊號來源            | 否決權      |
| :--------- | :----- | :------------------ | :---------- |
| **Tier 1** | 生存層 | VIX / GLI / VPIN    | ✅ 絕對否決 |
| **Tier 2** | 戰略層 | 事件驅動 > HMM 體制 | 定方向      |
| **Tier 3** | 戰術層 | Hurst / GEX         | 定進出時機  |

### 矛盾決策矩陣 (Signal Conflict Resolution)

當多個 AI 或訊號源「打架」時，依下表決定採納對象：

| 矛盾情境     | 訊號狀態                                  | 該聽誰   | 決策            |
| ------------ | ----------------------------------------- | -------- | --------------- |
| **價值陷阱** | PE 低 **BUT** Accrual 高                  | Sonnet   | ❌ 避開         |
| **動能過熱** | Momentum 極高 **BUT** Close >> TheoPrice  | Gemini   | ⚠️ 減碼或設停損 |
| **錯殺機會** | Momentum 低 **BUT** Alpha 高 + F-Score ≥7 | Opus     | ✅ 左側佈局     |
| **訊號背離** | 價格創新高 **BUT** Signal = Sell          | Grok     | 📉 獲利了結     |
| **擁擠交易** | Volume 飆高 + IVOL 上升                   | Thinking | ⚠️ 觀望或減碼   |
| **營運拐點** | Momentum 弱 **BUT** Rev MoM/YoY 加速      | ChatGPT  | ✅ 觀察進場     |

---

## 第一部分：終極裁決

在過往的投資理論發展中，許多舊觀點被證實存在缺陷，本系統對這些關鍵爭議做出明確裁決：

在風險模型方面，傳統的常態分佈假設和 VaR（風險價值）已被證明無法捕捉市場的極端風險。本系統改用肥尾分佈來建模資產報酬，並採用 CVaR（條件風險價值）和極值理論（Extreme Value Theory）來更準確地估計尾部風險。

在動能因子方面，傳統的原始報酬動能容易受到大盤和風格因子的污染，在因子反轉時會失效。本系統改用殘差動能，也就是從個股報酬中剝離 Fama-French 三因子（市場、規模、價值）之後的殘餘部分，這種方法能捕捉更純粹的公司特質 Alpha，具有更強的持續性。

在回測驗證方面，單純使用夏普比率（Sharpe Ratio）來評估策略容易產生偽陽性，因為它沒有考慮到多重測試問題和策略過擬合的風險。本系統採用 DSR（Deflated Sharpe Ratio）來調整試驗次數的影響，並配合 Walk-Forward Optimization（WFO）和 VPIN 壓力測試來確保策略的穩健性。

在數據來源方面，Yahoo Finance 雖然廣泛使用但穩定性不足。本系統以永豐金證券的 Shioaji API 作為台股即時和 Tick 數據的主要來源，並使用財報狗（StatementDog）作為基本面數據的主要來源，以確保數據品質。

在 IVOL（個股異質波動率）處理方面，本系統整合了「IVOL 之謎」的學術研究成果。根據傳統資產定價理論（CAPM），特異性風險是可以被分散的，不應獲得風險溢價。然而，大量實證研究發現高 IVOL 股票在未來往往表現出顯著的負 Alpha——這意味著高特異性波動率應被視為負面特徵。本系統的處理方式是：當高波動率搭配高品質（F-Score ≥ 7）時，這些股票可能是被市場錯殺的 Alpha 機會，應該優先買入；高 IVOL 且低 F-Score（≤ 4）的組合則應剔除。此外，本系統將 IVOL 作為風險懲罰因子納入綜合評分，用於降低高投機性股票的得分。

在因子標準化方面，傳統 Z-Score 存在結構性缺陷：它線性保留原始數據的分佈形態，如果原始因子呈現偏態或雙峰分佈，處理後的數據依然如此，導致不同因子的「1 分」代表的概率含義完全不同，因子間不可比較。本系統採用 SNDZ（Standard Normally Distributed Z-score on Percentile Rank）進行因子標準化——先將股票按因子值排序計算百分位排名，再代入標準正態分佈的逆累積分佈函數。這確保無論原始因子分佈多麼怪異，SNDZ 處理後的得分嚴格服從標準正態分佈 N(0,1)，使每個因子的貢獻度完全由權重決定，而非由其分佈形態決定。在板塊處理方面，本系統改用軟性板塊限額（單一板塊不超過 30%），既控制集中風險，又保留產業輪動帶來的獲利機會。

在部位規模配置方面，傳統的波動率倒數加權忽略了資產間的相關性。本系統採用 HRP（階層式風險平價）方法，先對資產相關性矩陣進行層級式聚類，再自上而下按照逆方差權重遞迴分配，這種方法更穩健且能考慮資產間的相關結構。

---

## 第二部分：投資哲學與元認知

本系統在策略驗證方面採用更嚴格的標準。傳統的夏普比率由於沒有調整試驗次數，容易讓「幸運的傻瓜」策略通過驗證。本系統要求策略必須達到 DSR（Deflated Sharpe Ratio）≥ 0.95 才能被認定為有效策略並進入實盤交易。DSR 值在 0.80 到 0.95 之間屬於灰色地帶，需要進一步驗證；低於 0.80 的策略被視為偽陽性，應該棄用。

在數據偏差處理方面，本系統識別並解決三種主要偏差。前視偏差（Look-ahead Bias）是指使用了未來才能知道的數據，解決方案是採用雙時序數據庫（Bitemporal），同時記錄數據的有效時間和交易時間。倖存者偏差（Survivorship Bias）是指數據集中剔除了失敗者，解決方案是納入所有退市股票的歷史數據。過擬合（Overfitting）是指參數針對歷史數據過度優化，解決方案是採用組合清除交叉驗證（CPCV）並控制錯誤發現率（FDR）。

在資金管理方面，本系統採用凱利公式來計算最佳倉位。凱利公式 f = (bp - q) / b 求出的是理論上使長期財富增長最大化的下注比例，其中 b 是賠率、p 是勝率、q 是敗率。然而，實務上使用 100% 凱利比例的破產風險過高，因此本系統推薦使用半凱利（50% Kelly），在增長和破產風險之間取得平衡。這個決策源自「毀滅的不可逆性」原則：遭遇 100% 損失時，無論平均回報多高，財富永久歸零。

在認知框架方面，本系統採用雙環學習模型。單環學習只關注「如何優化參數」，例如調整均線天數，只能帶來局部改善。雙環學習則會質問「為何使用此策略」，審視底層假設是否仍然成立，當體制發生結構性轉換時會切換至完全不同的策略，而非只是調參。

本系統也重視認知偏誤的管理。當處於 HALT 狀態（飢餓、憤怒、孤獨、疲憊）時，禁止做出交易決策。當「所有人都看到這個信號」時，應該啟用二階思維，考慮市場如何反應已被定價的共識。

在 Alpha 衰減監控方面，本系統認識到 Alpha 會隨時間指數式衰減，衰減速度由半衰期決定。當 Alpha 信號的年齡超過半衰期時，剩餘的獲利空間約為 50%，應該考慮減倉或出場。

本系統在 AI 共識決策方面也有明確規範。當 Claude 與 Gemini 意見一致時，直接採納；當多個 AI 意見分歧時，以「更保守」的建議為準；涉及台灣市場特殊規則時，優先採納具有台股經驗的分析。各模型的採納權重為：Claude 40%、Gemini 30%、ChatGPT 20%、其他 10%。

從更深層的哲學角度來看，本系統將市場視為複雜適應系統（CAS），而非熱力學平衡系統。市場具有肥尾效應和波動叢聚性，非線性反饋迴路使得微小變量可能引發系統崩潰。因此，本系統「不求預測，但求適應」——識別市場體制比猜測漲跌更重要。

反脆弱設計是本系統的核心原則之一。採用槓鈴策略，將 90% 資產配置於保守標的（現金或國債），10% 配置於激進標的（虛值期權），避開中間地帶。這種結構能從極端波動中獲益。

---

## 第三部分：市場物理學與全域監控

本系統建立了一套完整的市場監控體系，透過多個維度來識別市場狀態和風險水平。

VPIN（Volume-Synchronized Probability of Informed Trading）是核心的流動性毒性指標。它放棄傳統的時間鐘，改用交易量鐘來劃分數據，計算買賣不平衡以估計知情交易的概率。當 VPIN 低於 0.70 時，市場處於正常狀態，可以正常交易；VPIN 在 0.70 到 0.90 之間時，應該提高警覺並準備減倉；VPIN 超過 0.90 時，應該暫停逆勢單；VPIN 超過 0.95 時，應該撤出至現金。

VIX 恐慌指數是另一個重要的體制指標。VIX 低於 15 時市場平靜，可以維持 100% 曝險；VIX 在 15 到 25 之間時進入警戒狀態，應該降至 75% 曝險；VIX 在 25 到 40 之間時市場緊張，應該降至 50% 曝險；VIX 超過 40 時市場恐慌，應該降至 25% 曝險或完全撤出。

GLI（全球流動性脈衝指數）追蹤主要央行資產負債表的變化，是資產價格的領先指標，領先約 12 到 18 個月。當 GLI Z-Score 超過 +2σ 時，處於流動性海嘯狀態，可以全面做多風險資產；GLI 在 0 到 +2σ 之間時為正常擴張；GLI 在 -2σ 到 0 之間時為流動性收縮，應該減倉並進入防禦模式；GLI 低於 -2σ 時為流動性乾涸，現金為王。

GEX（Gamma Exposure）追蹤做市商的 Gamma 曝險。當做市商處於正 Gamma 狀態時，他們會高拋低吸，導致波動率被壓制，市場傾向均值回歸。當做市商處於負 Gamma 狀態時，他們會追漲殺跌，導致波動率放大，增加閃崩風險。

HMM（隱藏馬可夫模型）體制識別是本系統用來判斷市場狀態的主要方法。系統識別四種體制：平靜牛市（低波動、穩定上漲，適合動能策略和高 Beta）、恐慌熊市（高波動、急劇下跌，應該現金為王或做空）、高波震盪（無明確方向，適合均值回歸和低倉位）、以及流動性枯竭（應該完全撤出）。

Hurst 指數用來判斷市場的趨勢特性。當 Hurst 指數大於 0.5 時，市場具有趨勢持久性，動能策略有效；當 Hurst 指數小於 0.5 時，市場傾向均值回歸，反轉策略有效；當 Hurst 指數約等於 0.5 時，市場接近隨機遊走。

針對台股市場的特有結構，本系統也有專門的監控規則。當外資買超但法人持股比例未變時，可能是「假外資」，需要參照融資券餘額來驗證。當盤中爆量且融資增加時，可能是「隔日沖主力」操作，應該避免追高買入，等待隔日開盤洗盤後再進場。當股價突破關鍵壓力位且融券維持率逼近強制回補時，融券回補潮即將觸發，存在短期軋空行情的機會。

---

## 第四部分：Alpha 策略與訊號實驗室

本系統的策略執行採用三層決策架構。L1 硬篩層負責安全過濾，剔除 F-Score 低於 4 的低品質股、IVOL 超過 80% 的高波動股（除非 F-Score ≥ 7）、以及流動性不足的股票。L2 評分層進行多因子排序，權重配置為殘差動能 40%、品質因子 30%、籌碼結構 20%、技術動能 10%。L3 優化層進行部位配置，使用 HRP 階層式風險平價，同時確保單一持股不超過 10%、單一板塊不超過 30%。

殘差動能是本系統的核心 Alpha 來源。計算方式是從個股報酬中剔除大盤 Beta 和 Fama-French 因子的貢獻，公式為 ε_i,t = r_i,t - (β_mkt × r_mkt + β_SMB × r_SMB + β_HML × r_HML)。推薦的回顧期為 12 個月，持有期為 1 個月，選取殘差動能排名前 10% 的股票作為多頭，並要求品質門檻 F-Score ≥ 7。

本系統還採用層級式正交化架構來進一步純化 Alpha。第一層剝離市場因子，得到市場中性殘差；第二層剝離風格因子（規模和價值），得到市場與風格中性殘差；第三層剝離產業因子，得到最純粹的個股 Alpha。這種方法能提高 Alpha 純度、增強策略穩健性、並實現精準的績效歸因。

在因子剝離的技術選擇上，本系統提供兩種模式：

**傳統 OLS 正交化**：使用最小平方法直接回歸，強制剝離所有市場與風格波動。這是數學上最純粹的做法，保證殘差與因子完全正交。缺點是可能「錯殺」那些雖然與大盤同向移動、但本身具有獨特 Alpha 屬性的波動成分。

**PLS 監督式正交化（Partial Least Squares）**：這是一種「監督式降維」技術，在尋找投影方向時同時考慮「輸入特徵的變異量」與「對目標報酬的預測力」。與傳統 PCA 只看 X 變異量不同，PLS 會保留那些「雖然波動小，但與報酬率高度相關」的特徵。學術研究指出，當特徵數量多且高度相關（如多個技術指標）時，PLS 在預測上通常優於 PCA 或純 OLS。本系統建議將 PLS 殘差作為 OLS 殘差的對照版本進行回測比較，選擇 DSR 較高者作為實際交易訊號。

RCA（Regression Component Analysis）是 PLS 的近親，試圖在數學上找到一個封閉解，讓投影方向同時兼顧 OLS 的最小殘差特性與 PCA 的降維效率。這類技術統稱為「監督式降維」，核心理念是解決傳統 PCA 的致命傷：「變異量最大，不代表預測力最強」。在金融市場中，波動最大的往往是市場風險（Beta），而真正的 Alpha 往往藏在微小的波動中。

IVOL 與 F-Score 的交叉應用是本系統的特色策略之一。高 IVOL 加高 F-Score（≥ 7）的組合被視為「錯殺機會」，優先買入；高 IVOL 加低 F-Score（≤ 4）的組合被視為「彩票股」，應該剔除；低 F-Score 的股票無論 IVOL 高低，一律剔除。

Piotroski F-Score 完整 9 項指標分為三個維度：盈利能力方面，當年 ROA 大於零得 1 分、當年營業現金流大於零得 1 分、當年 ROA 優於去年得 1 分、營業現金流大於淨利潤（低應計項目）得 1 分；槓桿與流動性方面，長期債務比率較去年下降得 1 分、流動比率較去年上升得 1 分、本年度未發行新股得 1 分；運營效率方面，毛利率較去年上升得 1 分、資產周轉率較去年上升得 1 分。總分 7 分以上為高品質、4 分以下應剔除。

供應鏈傳導策略利用美股龍頭（如 NVIDIA、Apple）與台股供應商之間的領先落後關係。當美股龍頭大漲超過 3% 時，查詢供應鏈圖譜找出對應的台股標的，若開盤未反應則列入「搶進名單」。領先天數通常為 1 到 3 個交易日，持有期為 3 到 5 日。

在出場機制方面，本系統採用四機制出場協議。10% 止損：價格較月內最高價下跌超過 10% 時無條件清倉。波動率縮放：根據當前波動率相對於目標波動率的比例動態調整部位規模。殘差 RSI 背離：當價格創新高但殘差 RSI 未創新高時，視為獲利了結時機。時間止損：持有超過 12 個月時強制降權重或出場。

本系統也監控 Alpha 衰減和策略擁擠。所有動能信號都會隨時間雙曲線衰減（Hyperbolic Decay）。要評估策略的剩餘獲利空間，首先要計算信號的「年齡」，定義為殘差 Z-Score 首次突破 +1.0 至今的持續時間。假設典型的殘差動能半衰期為 6 個月，剩餘獲利空間與 e^(-Age/HL) 成正比。如果趨勢剛啟動 1-3 個月，衰減函數值仍高，預期收益豐厚；如果趨勢已經持續 10-12 個月，信號進入衰竭期，反轉風險劇增。

不同類型的 Alpha 有不同的半衰期：微結構訊號的半衰期為毫秒到分鐘級，擁擠風險極高；殘差動能的半衰期為週到月級，擁擠風險中等；供應鏈傳導的半衰期為日到週級，擁擠風險較低；基本面因子的半衰期為月到季級，擁擠風險最低。當成對相關性超過 0.8 時，視為擁擠警報，應該減倉因子曝險。擁擠度的量化方式是計算投資組合中前 10% 動能股的殘差相關係數，正常情況下殘差應是特質性的且相關度低，如果這些股票的殘差開始同步波動（相關係數飆升），說明大量量化資金在同向交易（Factor Crowding），此時 Alpha 已被套利殆盡。

溫水煮青蛙效應（Frog-in-the-Pan, FIP）是本系統關注的動能品質指標。研究指出，由「連續、少量」信息推動的動能比由「單次、巨大」信息推動的動能更持久。低資訊離散度（ID）代表連續的資訊揭露，動能品質強且持久，6 個月回報約 8.86%；高資訊離散度代表離散的資訊揭露（如單次利好暴漲），動能較弱，6 個月回報約 2.91%。

殘差動能理論價格的計算採用 Alpha 衰減投影模型。設定持有視窗為 H（例如未來 1 個月或 3 個月），理論目標價格 P_target = P_t × (1 + Σβ·F_exp)^H × exp(∫α_resid/(1+λτ)dτ)，其中第一部分是根據 CAPM 或 Fama-French 模型計算的系統性預期回報，即便沒有動能股票也應該隨大盤上漲；第二部分是殘差動能貢獻，考慮到動能信號隨時間雙曲線衰減的特性，其中 λ 是衰減參數，對於擁擠的動能交易 λ 較大，對於冷門股 λ 較小。

買入時機應在殘差 Z-Score 處於 +0.5 至 +1.5 區間時，代表趨勢已經形成但尚未過熱；賣出時機應在殘差 Z-Score 超過 +2.5 或 +3.0 時，根據統計學超過 3 個標準差的事件極難持續，價格回調機率遠大於繼續上漲的機率。此外，本系統將殘差収益流視為遵循 Ornstein-Uhlenbeck 過程的隨機變數，具備均值回歸特性，可用於界定價格的統計邊界。

---

## 第五部分：系統工程與數據基礎設施

本系統在數據來源方面有明確的優先順序。即時和 Tick 數據以 Shioaji 為首選，Yahoo Finance 作為美股日線的備援。基本面數據以財報狗為首選，TEJ（台灣經濟新報）作為補充。宏觀數據以 FRED（美國聯邦儲備經濟數據）為首選，涵蓋 VIX、M2、利率等指標，央行官網作為政策公告的來源。

DEFCON 等級系統是本系統的風險控制核心。DEFCON 5 為正常狀態，所有策略可以運行。DEFCON 4 在 VIX 超過 25 時觸發，應該減少新部位。DEFCON 3 在 VIX 超過 35 或 VPIN 發出警報時觸發，應該停止開立新部位。DEFCON 2 在 VIX 超過 40、處於負 GEX 區域、或 VPIN 超過 0.95 時觸發，應該減倉 50%。DEFCON 1 在系統性危機信號出現時觸發，應該撤出至現金。

在數據處理方面，本系統嚴格遵循雙時序架構（Bitemporal）。每筆數據必須同時記錄有效時間（數據描述的時間段）和交易時間（數據可被存取的時間）。回測時存取數據必須使用 transaction_time <= simulated_date 的條件，絕對禁止使用未來數據。

價格雙軌制是另一個重要的數據處理原則。軌道 A（訊號層）使用調整後價格（還原股價），用於計算技術指標和訓練 AI 模型。軌道 B（執行層）使用未調整價格（看板價格），用於計算部位規模和交易成本分析。混用兩軌價格會導致部位計算錯誤，產生虛假績效（Phantom Alpha）。

Walk-Forward Optimization（WFO）是本系統的策略驗證標準。數據被分為訓練集（60%）、測試集（20%）和前進測試（20%），然後滾動向前驗證。僅使用樣本內測試不足以驗證策略有效性，有極高的過擬合風險。

組合清除交叉驗證（CPCV）進一步降低過擬合風險。清除（Purging）刪除與測試集標籤時間重疊的訓練樣本；禁運（Embargoing）在測試集後額外刪除一段數據；組合生成產生 Sharpe Ratio 分布，用來計算「策略失敗機率」。

市場衝擊的計算採用平方根法則：I(Q) = Y × σ × √(Q/V)，其中 Y 是常數、σ 是波動率、Q 是交易量、V 是日均成交量。當預期回報小於預期成本時，應該削減或取消交易。在負 Gamma 區域時，系統會自動調高預期交易成本係數並收緊交易權限。

在技術架構方面，本系統採用六角形架構（Hexagonal Architecture），將應用核心（Commands、Queries、Domain）與外部依賴（Ports、Adapters）分離。技術棧包括 Python 3.13 作為開發語言、uv 作為套件管理器、python-fire 作為 CLI 框架、injector 作為依賴注入容器、Delta Lake 作為數據湖（規劃中）、Shioaji 作為券商 API、Gemini API 作為 AI 後端。

每日作業流程包括：盤前 08:00 更新美股收盤數據並計算 GLI 和 VIX Tier，產出風險儀表板；盤中 09:00 到 13:30 進行 VPIN 即時監控和異常警報，透過 Slack 通知；收盤後 14:00 執行全股池掃描，產出候選股清單；收盤後 15:00 生成日報；週末執行週報進行績效回顧。

在認知工程方面，本系統採用分塊（Chunking）將複雜資訊分解為可管理的單元、漸進式揭露讓使用者先看概覽再看細節、以及保持命名和結構的一致性。知識被分佈式儲存在程式碼（業務邏輯）、測試（行為規格）、文件（設計決策與領域知識）、以及配置（可調整參數）中。

自由裁量干預僅在特定 DEFCON 等級時允許，選項包括參數降級（切換至半凱利）、強制平倉（特定高風險板塊）、以及邏輯注入。所有干預必須記錄並納入下次訓練。

---

這份方法論文件完整地定義了投資決策系統的理論基礎、執行規則和工程實踐，是整個系統設計和運作的核心參考依據。
